<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - LDrawLoader</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
			body {
				font-family: Monospace;
				background-color: #000;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				color: #888;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				display:block;
			}
			#info a {
				color: #f00;
				font-weight: bold;
				text-decoration: underline;
				cursor: pointer
			}
		</style>
</head>

<body>
<div id="info">
    <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - LDrawLoader
</div>
<script src="js/build/three.js"></script>

<script src="js/js/libs/inflate.min.js"></script>
<script src="js/js/loaders/FBXLoader.js"></script>

<script src="js/js/controls/FirstPersonControls.js"></script>

<script src="js/js/WebGL.js"></script>
<script src="js/js/libs/stats.min.js"></script>



<script src="js/js/controls/OrbitControls.js"></script>
<script src="js/js/libs/inflate.min.js"></script>
<script src='js/js/libs/dat.gui.min.js'></script>

<script>

			var container, progressBarDiv;

			var camera, scene, renderer, controls, gui, guiData;

			var modelFileList, model, textureCube;

			var envMapActivated = false;

			var ldrawPath = 'Wise1944/TestGame3d.github.io/tree/master/js/models';

			var modelFileList = {

				'tank':'fbx/t26_head.fbx',
				'tank26s':'fbx/t26_stat.fbx'
			};

			init();
			animate();


			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.set( 150, 200, 250 );

				// scene

				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xdeebed );

				var ambientLight = new THREE.AmbientLight( 0xdeebed, 0.4 );
				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
				directionalLight.position.set( - 1000, 1200, 1500 );
				scene.add( directionalLight );

				//

				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );

				controls = new THREE.OrbitControls( camera, renderer.domElement );

				//
				console.log(modelFileList);
				guiData = {
					modelFileName: modelFileList[ 'tank' ],
					envMapActivated: false
				};

                gui = new dat.GUI();//menu

				gui.add( guiData, 'modelFileName', modelFileList ).name( 'Model' ).onFinishChange( function () {//add button

					reloadObject( true );

				} );

				gui.add( guiData, 'envMapActivated' ).name( 'Env. map' ).onChange( function ( value ) {//add button

					envMapActivated = value;

					reloadObject( false );

				} );




				window.addEventListener( 'resize', onWindowResize, false );

				progressBarDiv = document.createElement( 'div' );
				progressBarDiv.innerText = "Loading...";
				progressBarDiv.style.fontSize = "3em";
				progressBarDiv.style.color = "#888";
				progressBarDiv.style.display = "block";
				progressBarDiv.style.position = "absolute";
				progressBarDiv.style.top = "50%";
				progressBarDiv.style.width = "100%";
				progressBarDiv.style.textAlign = "center";


				// load materials and then the model

				reloadObject( true );

			}

			function reloadObject( resetCamera ) {

				if ( model ) {

					scene.remove( model );

				}

				model = null;

				updateProgressBar( 0 );
				showProgressBar();

				var lDrawLoader =new THREE.FBXLoader();
				lDrawLoader
					.setPath( ldrawPath )
					.load( guiData.modelFileName, function ( group2 ) {

						if ( model ) {

							scene.remove( model );

						}

						model = group2;

						// Convert from LDraw coordinates: rotate 180 degrees around OX
						model.rotation.x = Math.PI;

						scene.add( model );

						// Adjust materials

					//	var materials = lDrawLoader.materials;

					//	if ( envMapActivated ) {

						//	if ( ! textureCube ) {

								// Envmap texture
							//	var r = "textures/cube/Bridge2/";
								//var urls = [ r + "posx.jpg", r + "negx.jpg",r + "posy.jpg", r + "negy.jpg",r + "posz.jpg", r + "negz.jpg" ];
							//	textureCube = new THREE.CubeTextureLoader().load( urls );
							//	textureCube.format = THREE.RGBFormat;
							//	textureCube.mapping = THREE.CubeReflectionMapping;

					//		}

							//for ( var i = 0, n = materials.length; i < n; i ++ ) {

						//		var material = materials[ i ];

						//		if ( material.userData.canHaveEnvMap ) {

						//			material.envMap = textureCube;

						//		}

						//	}

					//	}

						// Adjust camera and light

						var bbox = new THREE.Box3().setFromObject( model );
						var size = bbox.getSize( new THREE.Vector3() );
						var radius = Math.max( size.x, Math.max( size.y, size.z ) ) * 0.5;

						if ( resetCamera ) {

							controls.target0.copy( bbox.getCenter( new THREE.Vector3() ) );
							controls.position0.set( - 2.3, 2, 2 ).multiplyScalar( radius ).add( controls.target0 );
							controls.reset();

						}

						hideProgressBar();

					}, onProgress, onError );

					var  loaders = new THREE.FBXLoader();

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			//

			function animate() {

				requestAnimationFrame( animate );
				render();

			}

			function render() {

				renderer.render( scene, camera );

			}

			function onProgress( xhr ) {

				if ( xhr.lengthComputable ) {

					updateProgressBar( xhr.loaded / xhr.total );

					console.log( Math.round( xhr.loaded / xhr.total * 100, 2 ) + '% downloaded' );

				}

			}

			function onError() {

				var message = "Error loading model";
				progressBarDiv.innerText = message;
				console.log( message );

			}

			function showProgressBar() {

				document.body.appendChild( progressBarDiv );

			}

			function hideProgressBar() {

				document.body.removeChild( progressBarDiv );

			}

			function updateProgressBar( fraction ) {

				progressBarDiv.innerText = 'Loading... ' + Math.round( fraction * 100, 2 ) + '%';

			}

		</script>


</body>
</html>
